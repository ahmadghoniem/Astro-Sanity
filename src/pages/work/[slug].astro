---
import { sanityClient  } from "sanity:client";
import { PortableText } from "astro-portabletext";
import { imageUrlFor } from "@/lib/utils";
import Layout from "@/layouts/Layout.astro";
import LucideIcon from "@/components/ui/LucideIcon.astro";
import {ChevronLeft,ChevronRight} from "lucide"

export async function getStaticPaths() {
  const query = `*[_type == "post"] {
  ...,
  images[] {
    asset->{
      metadata{
      dimensions {
    height,
      width
      }
      },
      url
    },
    colSpan
  }
  }`;
  const posts = await sanityClient.fetch(query);
  console.log(posts);
  return posts.map((props,id) => {
    const prevArticle=posts[id-1];
    const nextArticle=posts[id+1];
    const { slug, title, excerpt,images } = props;
    return {
      params: { slug: slug.current },
      props: { title,excerpt,images,prevArticle,nextArticle },
    };
  });
}
const { title,excerpt,images,prevArticle,nextArticle } = Astro.props;
---
<Layout title={title}>
  <section class="p-12">
    <article>
      <figure class="grid grid-cols-6 grid-row-[min_content] gap-4">
        <figcaption style="--text-multiplier: 1.5;" class="text-center col-span-6 max-w-5xl mx-auto mb-32">
          <PortableText value={excerpt} />
        </figcaption>
        {images.map((img) => {
          console.log(img);
          return ( 
          <img
            class={`w-full ${img.colSpan}`}
            width={img.asset.metadata.dimensions.width}
            height={img.asset.metadata.dimensions.height}
            src={imageUrlFor(img).format("webp").url()}
            alt={title}
          />
        )
        })}
      </figure>
    </article>

    <div class="flex flex-row w-full justify-between mt-8">
      {prevArticle && (
        <a
          class="mr-auto flex flex-row-reverse gap-1 items-center"
          href={`/work/${prevArticle.slug.current}`}
        >
          <h3 class="text-left"> {prevArticle.title} </h3>
          <LucideIcon class="w-8 h-8" icon={ChevronLeft} />
        </a>
      )}
      {nextArticle && (
        <a
          class="ml-auto flex flew-row gap-1 items-center"
          href={`/work/${nextArticle.slug.current}`}
        >
          <h3 class="text-right">{nextArticle.title} </h3>
          <LucideIcon class="w-8 h-8" icon={ChevronRight} />
        </a>
      )}
    </div>
  </section>
</Layout>;
